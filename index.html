<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INC.OS | CORE_v4</title>
    <style>
        :root { --bg: #0a0a0a; --card: #111; --blue: #00aaff; --green: #39ff14; --text: #e0e0e0; }
        body { background: var(--bg); color: var(--text); font-family: "Segoe UI", sans-serif; margin: 0; padding: 15px; display: grid; grid-template-columns: 240px 1fr; gap: 15px; }
        @media (max-width: 768px) { body { grid-template-columns: 1fr; } }

        .sidebar { background: var(--card); padding: 20px; border-radius: 8px; border: 1px solid #222; }
        .logo { font-size: 1.5em; font-weight: bold; margin-bottom: 25px; border-bottom: 2px solid var(--blue); }
        .status-item { font-size: 0.65em; color: #555; margin-bottom: 12px; }
        .status-item b { color: var(--blue); display: block; font-size: 1.1em; }

        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .card { background: var(--card); border-radius: 8px; border: 1px solid #222; padding: 18px; }
        .big-value { font-size: 2em; font-weight: bold; color: var(--blue); }
        .active-text { color: var(--green) !important; text-shadow: 0 0 10px var(--green); }

        /* QR CODE FUNCIONAL */
        .qr-box { 
            width: 100px; height: 100px; background: #fff; padding: 5px; border-radius: 4px; 
            cursor: pointer; position: relative; transition: 0.3s; margin-right: 20px;
        }
        .qr-box:hover { box-shadow: 0 0 20px var(--blue); transform: scale(1.05); }
        .scan-line { position: absolute; width: 100%; height: 2px; background: var(--blue); top: 0; animation: scan 2s infinite linear; }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }

        /* MODAL */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .modal-content { background: #000; border: 1px solid var(--blue); padding: 30px; border-radius: 8px; width: 90%; max-width: 500px; text-align: center; }
        .key-display { background: #050505; border: 1px solid #222; padding: 15px; color: var(--green); font-family: monospace; font-size: 0.7em; margin: 20px 0; word-break: break-all; }
        .btn-sync { background: var(--blue); color: #000; border: none; padding: 15px; font-weight: bold; width: 100%; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo">INC<span style="color:var(--blue)">.OS</span></div>
        <div class="status-item">NODE STATUS<b id="node-status">STANDBY</b></div>
        <div class="status-item">LATÊNCIA<b id="lat">0ms</b></div>
        <div class="status-item">PULSOS ATIVOS<b>37333</b></div>
    </div>

    <div class="main-content">
        <div class="card">
            <div style="font-size:0.7em;color:#555">ATIVOS TOTAIS</div>
            <div class="big-value" id="saldo">OFFLINE</div>
        </div>
        <div class="card">
            <div style="font-size:0.7em;color:#555">SINCRONIA LATTICE</div>
            <div class="big-value" id="sync-val">0.00%</div>
        </div>

        <div class="card" style="grid-column: span 2; display: flex; align-items: center;">
            <div class="qr-box" onclick="abrirCofre()">
                <div class="scan-line"></div>
                <img id="qr-img" src="" style="width:100%">
            </div>
            <div style="font-size: 0.8em;">
                <div style="color:#555">ID: <span id="user-tag" style="color:#fff">AGUARDANDO...</span></div>
                <div style="margin-top:5px; color:#555">SEC: <span id="sec-tag" style="color:var(--blue)">BLOQUEADO</span></div>
                <button onclick="abrirCofre()" style="margin-top:10px; background:var(--blue); border:none; padding:8px 12px; font-weight:bold; cursor:pointer; border-radius:4px;">CRIAR CHAVE 2500</button>
            </div>
        </div>
    </div>

    <div id="modalCofre" class="modal">
        <div class="modal-content">
            <h2 style="color:var(--blue); margin:0;">GERAÇÃO DE CHAVE</h2>
            <p style="font-size:0.8em; color:#666;">n=2500 bits | Fórmula Freire | SVP Integrity</p>
            <div class="key-display" id="chave-atômica">...</div>
            <button class="btn-sync" onclick="sincronizarCore()">CONFIRMAR E SINCRONIZAR</button>
        </div>
    </div>

    <script>
        let chaveMestra = "";
        let isSinc = false;

        function abrirCofre() {
            chaveMestra = "INC_2500_" + Array.from({length: 40}, () => Math.floor(Math.random() * 16).toString(16)).join("").toUpperCase();
            document.getElementById("chave-atômica").innerText = chaveMestra;
            document.getElementById("modalCofre").style.display = "flex";
        }

        function sincronizarCore() {
            isSinc = true;
            document.getElementById("modalCofre").style.display = "none";
            document.getElementById("node-status").innerText = "SOVEREIGN";
            document.getElementById("node-status").className = "active-text";
            document.getElementById("user-tag").innerText = chaveMestra.substring(0, 12) + "...";
            document.getElementById("sec-tag").innerText = "LATTICE_ACTIVE";
            document.getElementById("sec-tag").style.color = "var(--green)";
            document.getElementById("sync-val").innerText = "100.00%";
            document.getElementById("sync-val").classList.add("active-text");
            document.getElementById("saldo").classList.add("active-text");
            alert("SINCRONIA ESTABELECIDA.");
        }

        async function update() {
            const t0 = performance.now();
            try {
                const r = await fetch("/api/nano_status");
                const d = await r.json();
                if(isSinc) document.getElementById("saldo").innerText = d.saldo.toLocaleString("en-US", {minimumFractionDigits: 2}) + " INC";
                document.getElementById("lat").innerText = Math.round(performance.now() - t0) + "ms";
            } catch(e) {}
            document.getElementById("qr-img").src = "https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=" + Math.random();
        }
        setInterval(update, 3000);
        update();
    </script>
</body>
</html>
