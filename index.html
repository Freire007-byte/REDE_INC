<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>INC.NEXUS | QUANTUM_CORE_v43</title>
    <style>
        :root { --bg: #020202; --card: #080808; --blue: #00aaff; --green: #39ff14; --gold: #fcd535; --text: #ffffff; --dim: #555; }
        * { box-sizing: border-box; font-family: "SF Mono", "Fira Code", monospace; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* BARRA DE INTEGRIDADE (VEM DO SERVIDOR) */
        .integrity-bar { background: #000; padding: 10px 20px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; font-size: 0.55em; letter-spacing: 1px; }
        .integrity-bar b { color: var(--green); text-shadow: 0 0 5px var(--green); }

        header { padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #111; }
        
        #viewport { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .card { background: var(--card); border: 1px solid #151515; border-radius: 12px; padding: 20px; margin-bottom: 15px; position: relative; }
        .label { font-size: 0.5em; color: var(--dim); text-transform: uppercase; margin-bottom: 8px; }
        
        .val-main { font-size: 2.2em; font-weight: 900; color: var(--text); }
        .status-tag { font-size: 0.5em; background: rgba(0,170,255,0.1); color: var(--blue); padding: 4px 8px; border-radius: 4px; border: 1px solid var(--blue); }

        /* TABELA DE BLOCOS */
        .block-info { display: flex; justify-content: space-between; font-size: 0.7em; padding: 8px 0; border-bottom: 1px solid #0d0d0d; }

        nav { background: #000; border-top: 1px solid #222; display: flex; position: fixed; bottom: 0; width: 100%; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { flex: 1; padding: 18px; text-align: center; font-size: 0.6em; color: var(--dim); cursor: pointer; }
        .nav-item.active { color: var(--blue); border-top: 2px solid var(--blue); }
    </style>
</head>
<body>

    <div class="integrity-bar">
        <span>NUCLEO_ENTROPIA: <b id="entropy-val">0.00%</b></span>
        <span>STATUS: <b>PÓS-QUÂNTICO_ATIVO</b></span>
    </div>

    <header>
        <div style="font-weight:900; font-size:1.1em; color:var(--blue);">INC<span style="color:#fff">.NEXUS</span></div>
        <div class="status-tag" id="net-state">SINCRONIZANDO...</div>
    </header>

    <div id="viewport">
        <div class="card">
            <div class="label">Tesouraria (Coração da Rede)</div>
            <div class="val-main" id="tesouraria-val">$ 0.00</div>
            <div style="font-size:0.5em; color:var(--green); margin-top:10px;">PROVA DE SOBERANIA ATIVA</div>
        </div>

        <div class="card">
            <div class="label">Status da Ledger (Memória PQC)</div>
            <div class="block-info"><span>Blocos Processados:</span><b id="block-count">0</b></div>
            <div class="block-info"><span>Segurança:</span><b style="color:var(--blue)">LATTICE_2500</b></div>
            <div class="block-info" style="border:none;"><span>Latência:</span><b id="latency-val">-- ms</b></div>
        </div>

        <div class="card" style="border-color: var(--gold);">
            <div class="label" style="color:var(--gold);">Sua Identidade Quântica</div>
            <div id="user-hash" style="font-family:monospace; font-size:0.5em; color:var(--dim); word-break:break-all;">Aguardando Auth...</div>
        </div>
    </div>

    <nav>
        <div class="nav-item active">Terminal</div>
        <div class="nav-item">Cofre</div>
        <div class="nav-item" onclick="location.reload()">Sync</div>
    </nav>

    <script>
        const API = window.location.origin; // Usa a URL da Vercel automaticamente

        async function syncNetwork() {
            const start = Date.now();
            try {
                // Busca status geral do servidor.py
                const resStatus = await fetch(`${API}/status`);
                const dataStatus = await resStatus.json();
                
                // Busca integridade do NucleoAtomico
                const resNano = await fetch(`${API}/api/nano_status`);
                const dataNano = await resNano.json();

                // Atualiza UI com dados REAIS do back-end
                document.getElementById('tesouraria-val').innerText = "$ " + dataStatus.tesouraria.toLocaleString('en-US', {minimumFractionDigits: 2});
                document.getElementById('block-count').innerText = dataStatus.blocos;
                document.getElementById('entropy-val').innerText = dataNano.integridade.toFixed(2) + "%";
                document.getElementById('user-hash').innerText = dataStatus.seguranca;
                document.getElementById('net-state').innerText = "CONECTADO";
                document.getElementById('latency-val').innerText = (Date.now() - start) + " ms";

            } catch (e) {
                document.getElementById('net-state').innerText = "ERRO_LINK";
                document.getElementById('net-state').style.color = "red";
            }
        }

        // Loop de sincronia com o servidor a cada 3 segundos
        setInterval(syncNetwork, 3000);
        window.onload = syncNetwork;
    </script>
</body>
</html>
